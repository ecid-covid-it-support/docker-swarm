#!/usr/bin/env bash

INSTALL_PATH="$(realpath $0 | grep .*docker-swarm -o)"

case $1 in
    start)
		COMMAND="/scripts/start.sh $(echo $@ | sed "s/$1//g")"
		;;
	stop)
		COMMAND="/scripts/stop.sh $(echo $@ | sed "s/$1//g")"
		;;
	backup)
        PARAMETERS=$@
        EXPRESSION_BKP="$(echo "$@" | grep -o -P '(?<=--expression ).*' | sed 's/--.*//g')"

        if [ "${EXPRESSION_BKP}" ];then
            PARAMETERS="$(echo -e "$@" \
                | sed 's/\-\-/\n\-\-/g' \
                | sed '/expression/d' \
                | sed -z 's/\n//g') --expression \"${EXPRESSION_BKP}\""
        fi

		COMMAND="/scripts/volumes.sh ${PARAMETERS}"
		;;
	restore)
		COMMAND="/scripts/volumes.sh $@"
		;;
    update)
		COMMAND="/scripts/update.sh $(echo $@ | sed "s/$1//g")"
		;;
	*)
		echo "Sorry, I don't understand"
		exit
		;;
esac

bash -c "${INSTALL_PATH}${COMMAND}"
